<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Agent Panel Compacted</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
    <style>
        /* Setup for Inter font and light theme body styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9f9f9; /* bg-zinc-50 - Very Light Gray */
            min-height: 100vh;
            padding: 0.5rem;
        }

        /* Base Card Styling (Sharp corners internally) */
        .card-base {
            transition: all 0.3s ease-in-out;
            border-radius: 0; /* Sharp corners internally */
            border: 1px solid #d1d5db; /* border-gray-300 */
        }

        .card-base:hover {
            transform: translateY(-1px);
        }

        /* Smaller, status dot - kept circular for functional appearance */
        .status-dot {
            width: 8px;
            height: 8px;
            min-width: 8px;
            min-height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        /* Action buttons refined for consistency and modern look (Sharp corners) */
        .action-btn {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0; /* Sharp corners */
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.05), 0 1px 2px -1px rgba(0, 0, 0, 0.05);
        }

        .action-btn:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -2px rgba(0, 0, 0, 0.08);
        }

        /* --- CSS-ONLY INTERACTION LOGIC (Only for Log Sidebar) --- */
        #log-toggle-check { display: none; }
        #log-toggle-check:checked ~ #floating-log-sidebar {
            --tw-translate-x: 0px;
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));
        }

        @media (min-width: 640px) {
            .sm\:w-96 { width: 24rem; }
        }
    </style>
</head>

<body class="bg-zinc-50">

    <!-- Main Application Container (Minimal rounding applied here) -->
    <div id="app" class="max-w-6xl mx-auto bg-white rounded-sm shadow-xl flex flex-col h-[90vh] border border-gray-400">

        <!-- Header: Consistent Horizontal Padding (px-4) -->
        <header class="flex justify-between items-center px-4 py-3 border-b border-gray-300 bg-gray-100 rounded-t-sm flex-shrink-0">
            <div class="flex justify-between w-full items-center space-x-3">
                <h1 class="text-lg font-semibold text-gray-900 tracking-tight flex items-center">
                    <i class="fab fa-whatsapp text-gray-800 mr-2 text-xl"></i>Dev & Testing Panel
                </h1>

                <div class="flex items-center space-x-2">
                    <button class="action-btn bg-white text-gray-800 border border-gray-400 hover:bg-gray-200" title="Stop Session & Save Profile">
                        <i class="fas fa-power-off text-xs"></i>
                    </button>
                    <button class="action-btn bg-white text-gray-700 border border-gray-300 hover:bg-gray-50" title="Pause Session Logic">
                        <i class="fas fa-pause text-xs"></i>
                    </button>
                    <label for="log-toggle-check" class="action-btn bg-gray-900 border-2 border-gray-900 text-white hover:bg-black cursor-pointer" title="Toggle Live Log">
                        <i class="fas fa-terminal text-xs"></i>
                    </label>
                </div>
            </div>
        </header>

        <!-- Main Content Area: Flex 1 -->
        <div class="flex flex-1 overflow-hidden">

            <!-- 
            // LEFT SIDEBAR: WIDER SPACE (w-96) - BORDER REMOVED
            // The py-3 padding here creates the vertical space around the internal framed components.
            -->
            <div id="leftsidebar" class="w-96 bg-zinc-50 flex flex-col flex-shrink-0 space-y-3 py-3">

                <!-- Sidebar Header: Framed with border, padding, and margin -->
                <div class="px-4 py-3 mx-4 border border-gray-300 rounded-sm bg-gray-100 flex justify-between items-center flex-shrink-0 shadow-sm">
                    <span class="text-sm font-semibold text-gray-800 flex items-center">
                        <i class="fas fa-hashtag mr-2 text-gray-800"></i> Active Numbers <span id="active-numbers-count">(Loading)</span>
                    </span>
                    <span class="text-xs text-gray-500 font-medium">
                        <span class="status-dot bg-green-500 mr-1"></span> RUNNING
                    </span>
                </div>

                <!-- 
                // Number List (Scrollable) - Framed with border, padding, and margin 
                // This is where the JavaScript will inject the dynamic chat list items.
                -->
                <div id="chat-list-container" class="overflow-y-auto flex-1 flex flex-col space-y-0 bg-white border border-gray-300 mx-4 p-1 mb-2 shadow-inner rounded-sm">
                    <!-- Dynamic chat list items will be injected here by JavaScript -->
                    <div class="p-4 text-center text-sm text-gray-500">
                        <i class="fas fa-spinner fa-spin mr-2"></i>Loading chats...
                    </div>
                </div>

                <!-- Sidebar Footer (Message Input/Number Input): Framed with border and margin -->
                <div class="px-4 py-3 mx-4 border border-gray-300 rounded-sm flex-shrink-0 bg-gray-100 shadow-sm">
                    
                  

                    <!-- 2. Recipient Number and Send Button (Bottom, Inline) -->
                    <div class="flex items-end space-x-2">
                        
                        <!-- Recipient Number Input (Takes max space) -->
                        <div class="flex-1">
                            <label for="recipient-number" class="block text-xs font-medium text-gray-600 mb-1">Recipient Number</label>
                            <input type="text" id="recipient-number" placeholder="+1 (555) 555-5555" class="w-full px-2 py-1 border border-gray-300 rounded-sm focus:ring-gray-900 focus:border-gray-900 text-sm shadow-inner">
                        </div>

                        <!-- Send Button (Black accent, py-1 to match input height) -->
                        <button id="send-message-btn" class="bg-gray-900 text-white aspect-square  p-1 rounded-sm hover:bg-black transition duration-150 flex-shrink-0 border border-gray-900 shadow-sm">
                           <i class="fas fa-plus  text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Main Panel (Takes remaining space, has consistent vertical padding (py-3)) -->
            <div class="flex-1 px-4 py-3 flex flex-col space-y-3 bg-zinc-50 overflow-y-auto">

                <!-- Agent Toggles Card - Compacted Layout (Now Vertical) -->
                <div class="bg-white p-2 shadow-sm card-base border-gray-300">
                    <div class="flex flex-col space-y-2">

                        <!-- Outreach Agent Control Section (Compact) -->
                        <div class="w-full flex justify-between items-center pb-2 border-b border-gray-200">
                            
                            <!-- Agent Name (Text size is maintained, icon is smaller) -->
                            <span class="text-sm font-semibold text-gray-700 flex items-center whitespace-nowrap">
                                <i class="fas fa-bullhorn mr-2 text-base text-gray-700"></i> Outreach Agent
                            </span>
                            
                            <!-- Controls (Smaller Icons, tighter spacing) -->
                            <div class="flex items-center space-x-2">
                                <!-- Start/Play Button -->
                                <button class="text-green-600 hover:text-green-700 transition duration-150 p-1 rounded-sm" title="Start Outreach Agent">
                                    <i class="fas fa-play text-base"></i>
                                </button>
                                <!-- Pause Button -->
                                <button class="text-blue-500 hover:text-blue-600 transition duration-150 p-1 rounded-sm" title="Pause Outreach Agent">
                                    <i class="fas fa-pause text-base"></i>
                                </button>
                                <!-- Stop Button -->
                                <button class="text-red-500 hover:text-red-600 transition duration-150 p-1 rounded-sm" title="Stop Outreach Agent">
                                    <i class="fas fa-stop text-base"></i>
                                </button>
                                <!-- Settings Button -->
                                <button class="text-gray-500 hover:text-gray-700 transition duration-150 p-1 rounded-sm" title="Outreach Settings">
                                    <i class="fas fa-cog text-base"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Auto-Reply Agent Control Section (Compact) -->
                        <div class="w-full flex justify-between items-center pt-1">
                            
                            <!-- Agent Name (Text size is maintained, icon is smaller) -->
                            <span class="text-sm font-semibold text-gray-700 flex items-center whitespace-nowrap">
                                <i class="fas fa-robot mr-2 text-base text-gray-700"></i> Auto-Reply Agent
                            </span>
                            
                            <!-- Controls (Smaller Icons, tighter spacing) -->
                            <div class="flex items-center space-x-2">
                                <!-- Start/Play Button -->
                                <button class="text-green-600 hover:text-green-700 transition duration-150 p-1 rounded-sm" title="Start Auto-Reply Agent">
                                    <i class="fas fa-play text-base"></i>
                                </button>
                                <!-- Pause Button -->
                                <button class="text-blue-500 hover:text-blue-600 transition duration-150 p-1 rounded-sm" title="Pause Auto-Reply Agent">
                                    <i class="fas fa-pause text-base"></i>
                                </button>
                                <!-- Stop Button -->
                                <button class="text-red-500 hover:text-red-600 transition duration-150 p-1 rounded-sm" title="Stop Auto-Reply Agent">
                                    <i class="fas fa-stop text-base"></i>
                                </button>
                                <!-- Settings Button -->
                                <button class="text-gray-500 hover:text-gray-700 transition duration-150 p-1 rounded-sm" title="Auto-Reply Settings">
                                    <i class="fas fa-cog text-base"></i>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Dashboard Placeholder -->
                <div class="flex-1 bg-white shadow-sm card-base border-gray-300">
                    <div class="p-5 text-center text-gray-400 h-full flex flex-col justify-center items-center">
                        <i class="fas fa-chart-line text-4xl mb-3 text-gray-200"></i>
                        <p class="text-base font-semibold text-gray-700 mb-1">Operational Dashboard</p>
                        <p class="text-xs font-light text-gray-500 max-w-xs">Select an active WhatsApp number from the left panel to view real-time chat logs, metrics, and session details.</p>
                    </div>
                </div>

            </div> 
            <!-- End Right Main Panel -->

        </div> 
        <!-- End Main Content Area -->

    </div> 
    <!-- End App Container -->

    <!-- Floating Log Sidebar (Retains dark theme for console contrast) -->
    <input type="checkbox" id="log-toggle-check">
    <aside id="floating-log-sidebar" class="fixed top-0 right-0 h-full w-full sm:w-96 bg-gray-900 text-gray-200 shadow-2xl z-50 p-6 transform transition-transform duration-300 ease-in-out border-l-4 border-gray-700 translate-x-full">

        <div class="flex justify-between items-center mb-4 pb-2 border-b-2 border-gray-700">
            <h3 class="text-xl font-bold text-gray-100 flex items-center">
                <i class="fas fa-terminal mr-2 text-gray-400"></i> Real-Time Log Console
            </h3>
            <label for="log-toggle-check" class="text-gray-400 hover:text-white transition duration-150 p-1 rounded-sm hover:bg-gray-800 focus:outline-none cursor-pointer">
                <i class="fas fa-times text-lg"></i>
            </label>
        </div>

        <div id="sidebar-log-content" class="h-[calc(100vh-80px)] overflow-y-auto font-mono text-xs space-y-1">
            <div class="text-green-400">
                <span class="font-mono text-[10px] text-gray-400 mr-2">[15:52:10]</span>Phase 1: Initializing environment.
            </div>
            <div class="text-green-400">
                <span class="font-mono text-[10px] text-gray-400 mr-2">[15:52:11]</span>Status: Authentication successful for dev profile.
            </div>
            <div class="text-green-400">
                <span class="font-mono text-[10px] text-gray-400 mr-2">[15:52:12]</span>Agent action: **Outreach** is set to **Play**.
            </div>
            <div class="text-green-400">
                <span class="font-mono text-[10px] text-gray-400 mr-2">[15:52:13]</span>Loaded 7 active WA numbers. Ready to handle traffic.
            </div>
            <div class="text-yellow-400">
                <span class="font-mono text-[10px] text-gray-400 mr-2">[15:52:14]</span>Warning: Auto-Reply agent is currently Paused.
            </div>
            <div class="text-green-400">
                <span class="font-mono text-[10px] text-gray-400 mr-2">[15:52:20]</span>Monitoring number: +1 (555) 123-4567.
            </div>
            <div class="text-gray-300">
                <span class="font-mono text-[10px] text-gray-400 mr-2">[15:52:21]</span>ACTION: User attempted to send message to +1 (555) 555-5555.
            </div>
            <div class="text-red-400">
                <span class="font-mono text-[10px] text-gray-400 mr-2">[15:52:21]</span>ERROR: Recipient validation failed. Invalid format.
            </div>
        </div>
    </aside>

    <script>
        // Store the mock chat data globally so it can be updated
        let mockChats = [];
        let totalChatCount = 0;

        /**
         * Function to simulate fetching chat data from the API endpoint.
         * * @returns {Promise<Object>} A promise that resolves with the mock API response data.
         */
        async function mockFetchChats() {
            // --- MOCK CODE FOR DEMO: Returns the structure provided in the prompt ---
            console.log("Mock API call: Fetching /whatsapp/chats...");
            await new Promise(resolve => setTimeout(resolve, 500)); // Simulate network latency

            const initialMockData = {
                "success": true,
                "chats": [
                    { "id": "chat_0", "ranking": 1, "isPinned": true, "title": "+91 96538 10273", "recentMessage": "Hello, how can I help you today?" },
                    { "id": "chat_1", "ranking": 2, "isPinned": false, "title": "Suraj Raika", "recentMessage": "Thanks for your message! I'll get back to you soon." },
                    { "id": "chat_2", "ranking": 3, "isPinned": false, "title": "Papa Ji", "recentMessage": "d & f block elements -Reasoning Questions.pdf â€¢ 20 pages" },
                    { "id": "chat_3", "ranking": 4, "isPinned": false, "title": "WhatsApp Alerts", "recentMessage": "Sync your contacts to instantly find your favorite people Then you're ready to chat..." },
                    { "id": "chat_4", "ranking": 5, "isPinned": true, "title": "Team Alpha Support", "recentMessage": "Ticket #500 resolved: New feature deployed successfully." }
                ],
                "total_count": 5
            };
            
            // Initialize global mock state
            mockChats = initialMockData.chats;
            totalChatCount = initialMockData.total_count;
            
            return initialMockData;
            // --- END MOCK CODE ---
        }

        /**
         * Renders the chat list based on the stored data and updates the total count.
         */
        function updateChatList() {
            const container = document.getElementById('chat-list-container');
            const countElement = document.getElementById('active-numbers-count');

            if (mockChats.length === 0) {
                container.innerHTML = `<div class="p-3 text-red-500 text-center font-medium">No active chats found.</div>`;
                countElement.textContent = "(0)";
                return;
            }

            // Update total count in the sidebar header
            countElement.textContent = `(${totalChatCount})`;

            // Clear existing list
            container.innerHTML = '';

            // Render new chat items
            mockChats.forEach((chat, index) => {
                // Style the first item as selected for initial focus
                const isSelected = index === 0;
                
                const baseClasses = "numbers_item flex-shrink-0 py-1 px-3 transition duration-150 cursor-pointer text-sm";
                const selectedClasses = "bg-gray-100 border-l-4 border-gray-900 font-semibold text-gray-900";
                const defaultClasses = "hover:bg-gray-100 font-medium text-gray-700";

                const item = document.createElement('div');
                item.className = `${baseClasses} ${isSelected ? selectedClasses : defaultClasses}`;
                item.setAttribute('data-chat-id', chat.id);

                const iconColor = isSelected ? 'text-gray-900' : 'text-gray-400';
                const icon = `<i class="fas fa-mobile-alt mr-2 ${iconColor}"></i>`;

                // Truncate recent message for compact list view
                const truncatedMessage = chat.recentMessage.length > 30 
                    ? chat.recentMessage.substring(0, 30) + '...'
                    : chat.recentMessage;
                
                // Add a small message preview under the title
                const messagePreview = `<span class="block text-[10px] text-gray-500 truncate mt-0.5 ml-5">${truncatedMessage}</span>`;

                // Combine title, pin icon, and message preview
                item.innerHTML = `
                    <div class="flex items-center">
                        ${icon}
                        ${chat.title} 
                        ${chat.isPinned ? '<i class="fas fa-thumbtack text-gray-500 text-[8px] ml-auto" title="Pinned Chat"></i>' : ''}
                    </div>
                    ${messagePreview}
                `;
                
                container.appendChild(item);
            });
        }
        
        /**
         * Handles the "Send" button click event.
         * Simulates sending a message and creating a new chat entry if needed.
         */
        function handleSendMessage() {
            const messageContent = document.getElementById('chat-input').value.trim();
            const recipientNumber = document.getElementById('recipient-number').value.trim();

            if (!messageContent || !recipientNumber) {
                // Using alert() is forbidden, replacing with console log and visual feedback idea
                console.error('Validation Error: Please enter both a message and a recipient number.');
                // In a real app, this would show a non-blocking UI notification.
                return;
            }
            
            console.log(`Sending message to ${recipientNumber}: "${messageContent}"`);
            
            // 1. Check if the chat already exists (mock check based on title/number)
            const existingChatIndex = mockChats.findIndex(chat => chat.title === recipientNumber);
            
            if (existingChatIndex !== -1) {
                // Chat exists: Update the recent message and move to the top
                const existingChat = mockChats[existingChatIndex];
                existingChat.recentMessage = messageContent;
                // Remove from current position
                mockChats.splice(existingChatIndex, 1); 
                // Add to the top (index 0)
                mockChats.unshift(existingChat);
                console.log(`Updated existing chat for ${recipientNumber}.`);
            } else {
                // Chat does not exist: Create a new chat object
                const newChat = {
                    id: `chat_${Date.now()}`, // Unique ID
                    ranking: 0, // Will be re-ranked by being prepended
                    isPinned: false, 
                    title: recipientNumber,
                    recentMessage: messageContent
                };
                
                // Prepend the new chat to the list
                mockChats.unshift(newChat);
                totalChatCount++;
                console.log(`Created new chat for ${recipientNumber}. New total: ${totalChatCount}`);
            }

            // 2. Re-render the list to reflect the change
            updateChatList();
            
            // 3. Clear the message input field
            document.getElementById('chat-input').value = '';
        }

        // Initial setup and event listeners on window load
        window.onload = async function() {
            // 1. Fetch initial mock data and render
            const initialData = await mockFetchChats();
            updateChatList(initialData);
            
            // 2. Attach event listener to the Send button
            document.getElementById('send-message-btn').addEventListener('click', handleSendMessage);
        };
    </script>

</body>

</html>